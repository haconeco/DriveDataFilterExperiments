# Issue 0002: 層化サンプリング要件の詳細設計確定

## 背景
nuScenesを例に層化サンプリングを導入するためには、シナリオ軸・ビン設計・目標分布・例外処理を定量的に定義し、関係者が同一前提で議論できるドキュメントを整備する必要があります。本Issueでは軸候補の網羅・優先順位づけだけでなく、データ量検証の具体的な作業や承認プロセスまで詳細化します。

## タスク
1. **シナリオ軸候補の棚卸しと優先度決定**
   - `scene`, `log`, `map`、CAN-bus、`sample_annotation` から取得できる候補軸（天候、時間帯、ロケーション、道路種別、交通量、自車挙動など）を一覧化する。
   - 軸ごとに「収集容易性」「再現性」「カバレッジへの寄与」「既存データ量」の評価スコアを作成し、優先的に層化へ組み込む軸を決定する。
   - 将来追加を想定した軸（例：周辺車両の挙動、路面状態）についても拡張計画を整理する。
2. **軸ごとのビン定義の細分化**
   - 各軸について生データの分布を取得し、ビン境界候補をデータ駆動で決定する（例：時間帯＝`0-5`, `5-10`, …、速度＝`0-10`, `10-30`, `30+` km/h）。
   - ビン設定時に、データが存在しない領域・極端に少ない領域を特定し、統合や再分割のルールを明文化する。
   - ビン名称、条件式、使用するデータフィールド、単位系（m/s, km/h）を整理したテーブルを作成する。
3. **目標分布とサンプリングポリシーの仕様化**
   - 学習データセットの目標クリップ数と、軸ごとの期待割合を決定する（例：雨天夜間交差点は最小××件確保）。
   - 各層の目標数と現状数を比較し、サンプリング確率を計算する式を定義する（上限下限、指数補正、スケール調整を含む）。
   - データが未取得またはCAN欠損の場合の代替処理（例：別軸での補間、低優先度タグ付け）を決める。
4. **検証データおよび承認プロセスの整備**
   - nuScenes v1.0 mini/full それぞれに対して上記設計を適用し、分布サマリーレポートを作成する。
   - 分布サマリーから想定との乖離・欠損をレビューし、必要な調整を記録する。
   - ドキュメント化した仕様書を関係者レビュー（データエンジニア、モデリング、運用）のステップに乗せ、承認者・期限・議事録テンプレートを定義する。

## 必要な追加情報
- `scene.description` 内で使用されている天候／時間帯のラベル一覧。
- CAN-busログの収集可否（ボストン／シンガポールの両方で利用可能か）と欠損率。
- Map API を利用する際のレイヤー命名規則と道路種別のマッピング仕様。

## 成果物
- シナリオ軸・評価スコア・ビン定義をまとめた詳細仕様書（テーブル形式）。
- 目標分布・サンプリングポリシー・例外処理を定義した設計書。
- 分布サマリーおよびレビュー記録、承認完了の証跡。
