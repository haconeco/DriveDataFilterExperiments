# Issue 0003: nuScenesデータ処理パイプラインの実装

## 背景
層化サンプリングを実施するには、nuScenesのセンサーデータ・メタデータ・CAN情報をクリップ単位に分割し、シナリオ軸に沿ったメタデータを抽出・集約するパイプラインが不可欠です。安定したデータ加工処理を整備することで、後続の分布分析やサンプリング処理を自動化できます。

## タスク詳細
1. **データ取得と依存パッケージ整備**
   - nuScenes devkit環境を構築し、python-sdkサンプルを動かす。バージョン、依存ライブラリ、データ格納パスをドキュメント化する。【要参照: https://github.com/nutonomy/nuscenes-devkit/blob/master/python-sdk/nuscenes/can_bus/README.md】
   - ローカル/クラウドストレージから必要なセンサーデータ（Lidar, Radar, Camera）、アノテーション、CAN-busログ、mapデータを取得する手順を整備する。
2. **クリップ分割ロジックの実装**
   - サンプル（sample、sample\_data）を時系列で結合し、指定長（例: 5秒）でクリップ化するクラス/関数を作成する。
   - シーン境界やセンサー欠損時の取り扱い（クリップ破棄、補間）ルールを実装し、ログに記録する。
3. **静的コンテキスト抽出**
   - シーン/アノテーションメタデータから天候（attribute: weather）、時間帯（timestamp）、地図リージョン（map\_name）、道路種別（layer\_name）などを抽出し、正規化した列として付与する。
   - 地図APIから道路属性を取得する場合は、座標参照系とバッファ距離を定義し、取得エラー時のフォールバックを設計する。
4. **動的特徴量の算出**
   - CAN-busおよびIMUデータから平均速度、最大減速度、操舵角変化、ヨーレートなどの統計量を算出する処理を実装する。【要参照: https://github.com/nutonomy/nuscenes-devkit/blob/master/python-sdk/nuscenes/can_bus/README.md】
   - センサー欠損・サンプリングレート差異に対する補間/フィルタリングロジック（例: 線形補間、ローパスフィルタ）を実装し、精度検証を行う。
5. **オブジェクトアノテーション集計**
   - アノテーションテーブルからカテゴリ別の出現数、追従距離、速度レンジ、属性（例: vehicle.moving）をクリップ単位で集計する。
   - マルチラベルオブジェクト（例: pedestrian + umbrella）の扱い、追跡IDの分断時の集計方針をドキュメント化する。
6. **出力形式とデータ検証**
   - クリップメタデータを後続工程が読みやすい形式（Parquet/JSONL）に書き出すETL処理を実装し、スキーマ（列名・型・単位）を定義する。
   - 代表的なシーンでのデータ検証（レコード数、欠損率、統計量）を自動レポート化し、異常検知ルールを設定する。

## 成果物
- nuScenesクリップ生成およびメタデータ抽出スクリプト（リポジトリ格納）
- クリップ単位のメタデータスキーマ定義とETL手順書
- サンプルクリップデータセットと品質検証レポート

## 追加で確認すべき情報
- nuScenes生データへのアクセス可否と保存先（オンプレ/クラウド）
- 既存のデータ前処理基盤（Spark、Airflow等）との統合要件
- CAN-bus/IMUログの整合性チェックに利用できる社内基準値
